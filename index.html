<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç„å­¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #f4f1ea;
            color: #2c2c2c;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9IiNjY2MiIG9wYWNpdHk9IjAuMiIvPjwvc3ZnPg==');
        }
        .title-font { font-family: 'Ma Shan Zheng', cursive; }
        .header-cell {
            background-color: #e8e0c9;
            font-weight: bold;
            color: #5d4037;
            padding: 8px;
            border-bottom: 2px solid #8c8c8c;
            border-right: 1px solid #dcdcdc;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .data-cell {
            padding: 6px;
            text-align: center;
            border-bottom: 1px solid #dcdcdc;
            border-right: 1px solid #eee;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .stem-text { font-weight: bold; font-size: 1.6rem; font-family: 'Ma Shan Zheng'; }
        .branch-text { font-weight: bold; font-size: 1.6rem; font-family: 'Ma Shan Zheng'; }
        .section-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
            margin-bottom: 2rem;
            padding: 1.5rem;
        }
        
        /* å¸ƒå±€ Grid å®šä¹‰ */
        .bazi-table {
            display: grid;
            grid-template-columns: 80px repeat(4, 1fr);
            border: 2px solid #5d4037;
            background-color: #fffbf0;
        }
        /* ç»´åº¦æ ‡é¢˜åˆ— */
        .row-title {
            background-color: #d6d3c9;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #b0b0b0;
            border-right: 1px solid #5d4037;
            color: #4a4a4a;
        }

        /* èƒ¶å›Šæ ‡ç­¾ */
        .tag-pill {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin: 1px;
            white-space: nowrap;
        }
        .tag-good { background-color: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .tag-bad { background-color: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .tag-neutral { background-color: #f3f4f6; color: #4b5563; border: 1px solid #e5e7eb; }
    </style>
</head>
<body class="p-2 md:p-8 max-w-7xl mx-auto">

    <!-- å¤´éƒ¨ -->
    <header class="text-center mb-8">
        <h1 class="title-font text-5xl text-red-900 mb-2">å¤©æœº Â· å…«å­—æ’ç›˜</h1>
        <p class="text-gray-600 tracking-widest text-sm">æˆ‘åƒäº†ã€Šæ¸Šæµ·å­å¹³ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ã€Šåƒé‡Œå‘½ç¨¿ã€‹ã€Šç©·é€šå®é‰´ã€‹ã€Šä¸‰å‘½é€šä¼šã€‹ã€Šæ»´å¤©é«“-åŸæ–‡ã€‹ã€Šæ»´å¤©é«“é˜å¾®ã€‹ã€Šç¥å³°é€šè€ƒã€‹ã€Šå‘½ç†æ¢æºã€‹ã€Šæè™šä¸­å‘½ä¹¦ã€‹ã€Šäº”è¡Œå¤§ä¹‰ã€‹ã€Šç‰ç…§å®šçœŸç»ã€‹ã€Šé¬¼è°·é—æ–‡ã€‹ã€Šæ˜Ÿå¹³ä¼šæµ·ã€‹ã€Šå­å¹³ç®¡è§ã€‹ã€Šæ˜Ÿå‘½æŠ‰å¤å½•ã€‹ã€Šæœˆè°ˆèµ‹ã€‹ä½ å¯ä»¥æ”¾å¿ƒç®—äº†å§</p>
    </header>

    <!-- è¾“å…¥åŒº -->
    <div class="section-card mx-auto max-w-4xl" id="input-area">
        <h2 class="text-xl font-bold mb-4 border-l-4 border-red-800 pl-3">è¯·è¾“å…¥ç”Ÿè¾°ä¿¡æ¯</h2>
        <form id="bazi-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div>
                <label class="block text-sm font-bold mb-1 text-gray-700">å§“å</label>
                <input type="text" id="name" class="w-full border p-2 rounded bg-gray-50 focus:ring-2 ring-red-200 outline-none" placeholder="æŸæŸæŸ">
            </div>
            <div>
                <label class="block text-sm font-bold mb-1 text-gray-700">æ€§åˆ«</label>
                <select id="gender" class="w-full border p-2 rounded bg-gray-50 outline-none">
                    <option value="1">ç”· (ä¹¾é€ )</option>
                    <option value="0">å¥³ (å¤é€ )</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-bold mb-1 text-gray-700">å…¬å†ç”Ÿæ—¥</label>
                <input type="date" id="birthDate" class="w-full border p-2 rounded bg-gray-50 outline-none">
            </div>
            <div>
                <label class="block text-sm font-bold mb-1 text-gray-700">å‡ºç”Ÿæ—¶é—´</label>
                <input type="time" id="birthTime" class="w-full border p-2 rounded bg-gray-50 outline-none">
            </div>
            <div class="md:col-span-2 lg:col-span-3 text-center mt-4">
                <button type="submit" class="bg-red-900 text-white font-bold py-3 px-10 rounded shadow-lg hover:bg-red-800 transition transform hover:scale-105">
                    æ’ ç›˜ è¯¦ æ‰¹
                </button>
            </div>
        </form>
    </div>

    <!-- ç»“æœå±•ç¤ºåŒº -->
    <div id="result-area" class="hidden animate-fade-in space-y-8">
        
        <!-- 1. æ ¸å¿ƒæ’ç›˜è¡¨æ ¼ -->
        <div class="section-card">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b pb-4">
                <div>
                    <span id="res-name" class="text-3xl font-bold text-red-900 title-font mr-4"></span>
                    <span id="res-gender" class="text-lg text-gray-600 font-serif"></span>
                </div>
                <div class="text-right text-sm text-gray-500 mt-2 md:mt-0">
                    <p>å…¬å†ï¼š<span id="res-solar-date"></span></p>
                    <p>å†œå†ï¼š<span id="res-lunar-date">è‡ªåŠ¨æ¨æ¼”ä¸­...</span></p>
                </div>
            </div>

            <div class="overflow-x-auto pb-4">
                <!-- Grid å¸ƒå±€ -->
                <div class="bazi-table min-w-[700px]">
                    <!-- è¡¨å¤´ -->
                    <div class="row-title bg-gray-200">å››æŸ±</div>
                    <div class="header-cell">å¹´æŸ± (æ ¹) <span class="text-xs font-normal block text-gray-500 ml-1">1-16å²</span></div>
                    <div class="header-cell">æœˆæŸ± (è‹—) <span class="text-xs font-normal block text-gray-500 ml-1">17-32å²</span></div>
                    <div class="header-cell bg-red-50 text-red-900">æ—¥æŸ± (èŠ±) <span class="text-xs font-normal block text-red-400 ml-1">33-48å²</span></div>
                    <div class="header-cell">æ—¶æŸ± (æœ) <span class="text-xs font-normal block text-gray-500 ml-1">49-æ™šå¹´</span></div>

                    <!-- ä¸»æ˜Ÿ -->
                    <div class="row-title">ä¸»æ˜Ÿ<br>(åç¥)</div>
                    <div id="god-year" class="data-cell font-bold text-gray-600"></div>
                    <div id="god-month" class="data-cell font-bold text-gray-600"></div>
                    <div class="data-cell font-bold text-red-900 bg-red-50">æ—¥å…ƒ (æˆ‘)</div>
                    <div id="god-hour" class="data-cell font-bold text-gray-600"></div>

                    <!-- å¤©å¹² -->
                    <div class="row-title">å¤©å¹²</div>
                    <div id="stem-year" class="data-cell stem-text"></div>
                    <div id="stem-month" class="data-cell stem-text"></div>
                    <div id="stem-day" class="data-cell stem-text bg-red-50 text-red-700"></div>
                    <div id="stem-hour" class="data-cell stem-text"></div>

                    <!-- åœ°æ”¯ -->
                    <div class="row-title">åœ°æ”¯</div>
                    <div id="branch-year" class="data-cell branch-text"></div>
                    <div id="branch-month" class="data-cell branch-text"></div>
                    <div id="branch-day" class="data-cell branch-text bg-red-50"></div>
                    <div id="branch-hour" class="data-cell branch-text"></div>

                    <!-- è—å¹² -->
                    <div class="row-title">è—å¹²</div>
                    <div id="hidden-year" class="data-cell text-xs text-gray-500 leading-relaxed"></div>
                    <div id="hidden-month" class="data-cell text-xs text-gray-500 leading-relaxed"></div>
                    <div id="hidden-day" class="data-cell text-xs text-gray-500 leading-relaxed"></div>
                    <div id="hidden-hour" class="data-cell text-xs text-gray-500 leading-relaxed"></div>

                    <!-- å‰¯æ˜Ÿ -->
                    <div class="row-title">å‰¯æ˜Ÿ</div>
                    <div id="subgod-year" class="data-cell text-xs text-gray-500 leading-relaxed"></div>
                    <div id="subgod-month" class="data-cell text-xs text-gray-500 leading-relaxed"></div>
                    <div id="subgod-day" class="data-cell text-xs text-gray-500 leading-relaxed"></div>
                    <div id="subgod-hour" class="data-cell text-xs text-gray-500 leading-relaxed"></div>

                    <!-- æ˜Ÿè¿ (åäºŒé•¿ç”Ÿ) -->
                    <div class="row-title">æ˜Ÿè¿</div>
                    <div id="luck-year" class="data-cell text-sm"></div>
                    <div id="luck-month" class="data-cell text-sm"></div>
                    <div id="luck-day" class="data-cell text-sm font-bold"></div>
                    <div id="luck-hour" class="data-cell text-sm"></div>

                    <!-- è‡ªå -->
                    <div class="row-title">è‡ªå</div>
                    <div id="zizuo-year" class="data-cell text-xs text-gray-500"></div>
                    <div id="zizuo-month" class="data-cell text-xs text-gray-500"></div>
                    <div id="zizuo-day" class="data-cell text-xs text-gray-500 font-bold"></div>
                    <div id="zizuo-hour" class="data-cell text-xs text-gray-500"></div>

                    <!-- ç©ºäº¡ -->
                    <div class="row-title">ç©ºäº¡</div>
                    <div id="kongwang-year" class="data-cell text-sm"></div>
                    <div id="kongwang-month" class="data-cell text-sm"></div>
                    <div id="kongwang-day" class="data-cell text-sm text-gray-300">-</div>
                    <div id="kongwang-hour" class="data-cell text-sm"></div>

                    <!-- çº³éŸ³ -->
                    <div class="row-title">çº³éŸ³</div>
                    <div id="nayin-year" class="data-cell text-xs text-gray-600"></div>
                    <div id="nayin-month" class="data-cell text-xs text-gray-600"></div>
                    <div id="nayin-day" class="data-cell text-xs text-gray-600"></div>
                    <div id="nayin-hour" class="data-cell text-xs text-gray-600"></div>

                    <!-- ç¥ç… -->
                    <div class="row-title">ç¥ç…</div>
                    <div id="shensha-year" class="data-cell text-xs flex flex-wrap gap-1 content-center justify-center p-2"></div>
                    <div id="shensha-month" class="data-cell text-xs flex flex-wrap gap-1 content-center justify-center p-2"></div>
                    <div id="shensha-day" class="data-cell text-xs flex flex-wrap gap-1 content-center justify-center p-2"></div>
                    <div id="shensha-hour" class="data-cell text-xs flex flex-wrap gap-1 content-center justify-center p-2"></div>
                </div>
            </div>
            
            <div class="mt-4 flex justify-center space-x-8 text-sm text-gray-700 bg-gray-50 p-3 rounded">
                <div><span class="font-bold">èƒå…ƒï¼š</span><span id="taiyuan-text">--</span></div>
                <div><span class="font-bold">å‘½å®«ï¼š</span><span id="minggong-text">--</span></div>
                <div><span class="font-bold">æ—¬é¦–ï¼š</span><span id="xunshou-text">--</span></div>
            </div>
        </div>

        <!-- 2. äº”è¡Œæ—ºè¡°ä¸é€šä¿—å»ºè®® -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="section-card">
                <h3 class="text-xl font-bold mb-4 border-l-4 border-blue-800 pl-3">äº”è¡Œèƒ½é‡ä¸è¡¥è¿å»ºè®®</h3>
                <div class="h-64 w-full relative">
                    <canvas id="wuxingChart"></canvas>
                </div>
                <!-- èƒ½é‡æ¡å±•ç¤º -->
                <div class="grid grid-cols-5 gap-1 mt-4 text-center text-xs">
                    <div class="p-1 rounded bg-green-100 text-green-900 border border-green-200">æœ¨: <span id="score-wood">0</span></div>
                    <div class="p-1 rounded bg-red-100 text-red-900 border border-red-200">ç«: <span id="score-fire">0</span></div>
                    <div class="p-1 rounded bg-yellow-100 text-yellow-900 border border-yellow-200">åœŸ: <span id="score-earth">0</span></div>
                    <div class="p-1 rounded bg-gray-100 text-gray-800 border border-gray-300">é‡‘: <span id="score-metal">0</span></div>
                    <div class="p-1 rounded bg-blue-100 text-blue-900 border border-blue-200">æ°´: <span id="score-water">0</span></div>
                </div>

                <div class="mt-6">
                    <h4 class="font-bold text-lg text-gray-800 mb-2">ğŸ’¡ æ‚¨çš„è¡¥è¿æŒ‡å— (é€šä¿—ç‰ˆ)</h4>
                    <div id="vernacular-advice" class="text-sm text-gray-700 space-y-3 leading-relaxed bg-gray-50 p-4 rounded border border-gray-200">
                        <!-- JS æ³¨å…¥ -->
                    </div>
                </div>
            </div>

            <div class="section-card flex flex-col">
                <h3 class="text-xl font-bold mb-4 border-l-4 border-purple-800 pl-3">æ ¼å±€ä¸é˜´é˜³åˆ†æ</h3>
                
                <div class="mb-6">
                    <div class="flex items-center mb-2">
                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-bold mr-3">æœ¬å‘½æ ¼å±€</span>
                        <span id="pattern-name" class="text-2xl font-bold text-gray-800 title-font"></span>
                    </div>
                    <p id="pattern-desc" class="text-sm text-gray-600 italic border-l-2 border-gray-300 pl-3 py-1"></p>
                </div>

                <div class="space-y-4 flex-grow">
                    <div class="bg-white border border-gray-200 p-4 rounded shadow-sm">
                        <strong class="text-gray-800 block mb-1">â˜¯ï¸ é˜´é˜³å‚è€ƒ (å¤§ç™½è¯)</strong>
                        <p id="yinyang-text" class="text-sm text-gray-600 leading-relaxed"></p>
                    </div>
                    <div class="bg-white border border-gray-200 p-4 rounded shadow-sm">
                        <strong class="text-gray-800 block mb-1">ğŸ’ª èº«å¼ºèº«å¼± (å¤§ç™½è¯)</strong>
                        <p id="strength-text" class="text-sm text-gray-600 leading-relaxed"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. å››æŸ±æµå¹´ä¸€ç”Ÿè¯¦æ‰¹ -->
        <div class="section-card">
            <h3 class="text-2xl font-bold text-center mb-10 title-font text-red-900">å››æŸ±æµå¹´ Â· ä¸€ç”Ÿè¯¦æ‰¹</h3>
            
            <div class="space-y-10">
                <!-- æ ¹ï¼šå¹´æŸ± -->
                <div class="flex gap-4">
                    <div class="hidden md:flex flex-col items-center min-w-[80px]">
                        <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl">ğŸŒ±</div>
                        <div class="h-full w-0.5 bg-gray-200 mt-2"></div>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-gray-800">ç¬¬ä¸€é˜¶æ®µï¼šæ ¹åŸº (1-16å² å°‘å¹´)</h4>
                        <div class="text-xs text-gray-500 mb-2">å¯¹åº”å‚æ•°ï¼šå¹´æŸ± <span id="ref-year"></span></div>
                        <div id="detail-year" class="text-gray-700 text-sm leading-7 text-justify bg-gray-50 p-4 rounded border-l-4 border-gray-400"></div>
                    </div>
                </div>

                <!-- è‹—ï¼šæœˆæŸ± -->
                <div class="flex gap-4">
                    <div class="hidden md:flex flex-col items-center min-w-[80px]">
                        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-2xl text-green-700">ğŸŒ¿</div>
                        <div class="h-full w-0.5 bg-gray-200 mt-2"></div>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-gray-800">ç¬¬äºŒé˜¶æ®µï¼šæˆé•¿ (17-32å² é’å¹´)</h4>
                        <div class="text-xs text-gray-500 mb-2">å¯¹åº”å‚æ•°ï¼šæœˆæŸ± <span id="ref-month"></span></div>
                        <div id="detail-month" class="text-gray-700 text-sm leading-7 text-justify bg-green-50 p-4 rounded border-l-4 border-green-400"></div>
                    </div>
                </div>

                <!-- èŠ±ï¼šæ—¥æŸ± -->
                <div class="flex gap-4">
                    <div class="hidden md:flex flex-col items-center min-w-[80px]">
                        <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center text-2xl text-red-700">ğŸŒº</div>
                        <div class="h-full w-0.5 bg-gray-200 mt-2"></div>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-gray-800">ç¬¬ä¸‰é˜¶æ®µï¼šç››å¼€ (33-48å² ä¸­å¹´)</h4>
                        <div class="text-xs text-gray-500 mb-2">å¯¹åº”å‚æ•°ï¼šæ—¥æŸ± <span id="ref-day"></span></div>
                        <div id="detail-day" class="text-gray-700 text-sm leading-7 text-justify bg-red-50 p-4 rounded border-l-4 border-red-400"></div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-3 bg-white border border-pink-200 rounded shadow-sm">
                                <strong class="text-pink-700 block text-sm mb-1">â¤ï¸ å©šå§»æ„Ÿæƒ…</strong>
                                <p id="marriage-advice" class="text-xs text-gray-600"></p>
                            </div>
                            <div class="p-3 bg-white border border-blue-200 rounded shadow-sm">
                                <strong class="text-blue-700 block text-sm mb-1">ğŸ’¼ äº‹ä¸šæ–¹å‘</strong>
                                <p id="career-advice" class="text-xs text-gray-600"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœï¼šæ—¶æŸ± -->
                <div class="flex gap-4">
                    <div class="hidden md:flex flex-col items-center min-w-[80px]">
                        <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center text-2xl text-yellow-700">ğŸ</div>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-gray-800">ç¬¬å››é˜¶æ®µï¼šç»“æœ (49å²å æ™šå¹´)</h4>
                        <div class="text-xs text-gray-500 mb-2">å¯¹åº”å‚æ•°ï¼šæ—¶æŸ± <span id="ref-hour"></span></div>
                        <div id="detail-hour" class="text-gray-700 text-sm leading-7 text-justify bg-yellow-50 p-4 rounded border-l-4 border-yellow-400"></div>
                    </div>
                </div>
            </div>
        </div>

         <div class="text-center mt-6">
            <button id="btn-recalc"
                    class="inline-block bg-red-900 text-white font-bold py-2 px-6 rounded shadow hover:bg-red-800 transition transform hover:scale-105">
                è¿”å›é‡ç®—
            </button>
        </div>
        
        <div class="text-center pb-12 text-gray-400 text-xs">
            <p>â€» å‘½ç†å»ºè®®ä»…ä¾›å‚è€ƒï¼Œç§¯å–„ä¹‹å®¶å¿…æœ‰ä½™åº†ï¼Œå‘½è¿æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸­ â€»</p>
        </div>

    </div>

    <script>
        // --- æ ¸å¿ƒæ•°æ®åº“ (Data) ---
        const GAN = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
        const ZHI = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        const WUXING_MAP = {
            'ç”²': 'wood', 'ä¹™': 'wood', 'å¯…': 'wood', 'å¯': 'wood',
            'ä¸™': 'fire', 'ä¸': 'fire', 'å·³': 'fire', 'åˆ': 'fire',
            'æˆŠ': 'earth', 'å·±': 'earth', 'è¾°': 'earth', 'æˆŒ': 'earth', 'ä¸‘': 'earth', 'æœª': 'earth',
            'åºš': 'metal', 'è¾›': 'metal', 'ç”³': 'metal', 'é…‰': 'metal',
            'å£¬': 'water', 'ç™¸': 'water', 'äº¥': 'water', 'å­': 'water'
        };
        const WUXING_CN = {'wood': 'æœ¨', 'fire': 'ç«', 'earth': 'åœŸ', 'metal': 'é‡‘', 'water': 'æ°´'};
        const WUXING_COLORS = {
            'wood': '#22c55e', 'fire': '#ef4444', 'earth': '#eab308', 'metal': '#9ca3af', 'water': '#1e3a8a'
        };
        
        // è—å¹²è¡¨ (ä¸»æ°”, ä¸­æ°”, ä½™æ°”)
        const CANG_GAN = {
            'å­': ['ç™¸'], 'ä¸‘': ['å·±', 'ç™¸', 'è¾›'], 'å¯…': ['ç”²', 'ä¸™', 'æˆŠ'], 'å¯': ['ä¹™'],
            'è¾°': ['æˆŠ', 'ä¹™', 'ç™¸'], 'å·³': ['ä¸™', 'æˆŠ', 'åºš'], 'åˆ': ['ä¸', 'å·±'], 'æœª': ['å·±', 'ä¸', 'ä¹™'],
            'ç”³': ['åºš', 'å£¬', 'æˆŠ'], 'é…‰': ['è¾›'], 'æˆŒ': ['æˆŠ', 'è¾›', 'ä¸'], 'äº¥': ['å£¬', 'ç”²']
        };

        // çº³éŸ³è¡¨
        const NAYIN = {
            'ç”²å­': 'æµ·ä¸­é‡‘', 'ä¹™ä¸‘': 'æµ·ä¸­é‡‘', 'ä¸™å¯…': 'ç‚‰ä¸­ç«', 'ä¸å¯': 'ç‚‰ä¸­ç«', 'æˆŠè¾°': 'å¤§æ—æœ¨', 'å·±å·³': 'å¤§æ—æœ¨',
            'åºšåˆ': 'è·¯æ—åœŸ', 'è¾›æœª': 'è·¯æ—åœŸ', 'å£¬ç”³': 'å‰‘é”‹é‡‘', 'ç™¸é…‰': 'å‰‘é”‹é‡‘', 'ç”²æˆŒ': 'å±±å¤´ç«', 'ä¹™äº¥': 'å±±å¤´ç«',
            'ä¸™å­': 'æ¶§ä¸‹æ°´', 'ä¸ä¸‘': 'æ¶§ä¸‹æ°´', 'æˆŠå¯…': 'åŸå¤´åœŸ', 'å·±å¯': 'åŸå¤´åœŸ', 'åºšè¾°': 'ç™½èœ¡é‡‘', 'è¾›å·³': 'ç™½èœ¡é‡‘',
            'å£¬åˆ': 'æ¨æŸ³æœ¨', 'ç™¸æœª': 'æ¨æŸ³æœ¨', 'ç”²ç”³': 'æ³‰ä¸­æ°´', 'ä¹™é…‰': 'æ³‰ä¸­æ°´', 'ä¸™æˆŒ': 'å±‹ä¸ŠåœŸ', 'ä¸äº¥': 'å±‹ä¸ŠåœŸ',
            'æˆŠå­': 'éœ¹é›³ç«', 'å·±ä¸‘': 'éœ¹é›³ç«', 'åºšå¯…': 'æ¾æŸæœ¨', 'è¾›å¯': 'æ¾æŸæœ¨', 'å£¬è¾°': 'é•¿æµæ°´', 'ç™¸å·³': 'é•¿æµæ°´',
            'ç”²åˆ': 'æ²™ä¸­é‡‘', 'ä¹™æœª': 'æ²™ä¸­é‡‘', 'ä¸™ç”³': 'å±±ä¸‹ç«', 'ä¸é…‰': 'å±±ä¸‹ç«', 'æˆŠæˆŒ': 'å¹³åœ°æœ¨', 'å·±äº¥': 'å¹³åœ°æœ¨',
            'åºšå­': 'å£ä¸ŠåœŸ', 'è¾›ä¸‘': 'å£ä¸ŠåœŸ', 'å£¬å¯…': 'é‡‘ç®”é‡‘', 'ç™¸å¯': 'é‡‘ç®”é‡‘', 'ç”²è¾°': 'è¦†ç¯ç«', 'ä¹™å·³': 'è¦†ç¯ç«',
            'ä¸™åˆ': 'å¤©æ²³æ°´', 'ä¸æœª': 'å¤©æ²³æ°´', 'æˆŠç”³': 'å¤§é©¿åœŸ', 'å·±é…‰': 'å¤§é©¿åœŸ', 'åºšæˆŒ': 'é’—é’é‡‘', 'è¾›äº¥': 'é’—é’é‡‘',
            'å£¬å­': 'æ¡‘æŸ˜æœ¨', 'ç™¸ä¸‘': 'æ¡‘æŸ˜æœ¨', 'ç”²å¯…': 'å¤§æºªæ°´', 'ä¹™å¯': 'å¤§æºªæ°´', 'ä¸™è¾°': 'æ²™ä¸­åœŸ', 'ä¸å·³': 'æ²™ä¸­åœŸ',
            'æˆŠåˆ': 'å¤©ä¸Šç«', 'å·±æœª': 'å¤©ä¸Šç«', 'åºšç”³': 'çŸ³æ¦´æœ¨', 'è¾›é…‰': 'çŸ³æ¦´æœ¨', 'å£¬æˆŒ': 'å¤§æµ·æ°´', 'ç™¸äº¥': 'å¤§æµ·æ°´'
        };

        // --- ç®—æ³•å‡½æ•° ---

        // 1. åç¥è®¡ç®—
        function getTenGod(dayMaster, target) {
            if (!dayMaster || !target) return '';
            const dayIdx = GAN.indexOf(dayMaster);
            const targetIdx = GAN.indexOf(target);
            const dayElem = WUXING_MAP[dayMaster];
            const targetElem = WUXING_MAP[target];
            const isSameYinYang = (dayIdx % 2) === (targetIdx % 2);

            const relMap = {
                'wood': {'wood': 'æ¯”åŠ«', 'fire': 'é£Ÿä¼¤', 'earth': 'è´¢', 'metal': 'å®˜æ€', 'water': 'å°'},
                'fire': {'wood': 'å°', 'fire': 'æ¯”åŠ«', 'earth': 'é£Ÿä¼¤', 'metal': 'è´¢', 'water': 'å®˜æ€'},
                'earth': {'wood': 'å®˜æ€', 'fire': 'å°', 'earth': 'æ¯”åŠ«', 'metal': 'é£Ÿä¼¤', 'water': 'è´¢'},
                'metal': {'wood': 'è´¢', 'fire': 'å®˜æ€', 'earth': 'å°', 'metal': 'æ¯”åŠ«', 'water': 'é£Ÿä¼¤'},
                'water': {'wood': 'é£Ÿä¼¤', 'fire': 'è´¢', 'earth': 'å®˜æ€', 'metal': 'å°', 'water': 'æ¯”åŠ«'}
            };

            const type = relMap[dayElem][targetElem];
            if (type === 'æ¯”åŠ«') return isSameYinYang ? 'æ¯”è‚©' : 'åŠ«è´¢';
            if (type === 'é£Ÿä¼¤') return isSameYinYang ? 'é£Ÿç¥' : 'ä¼¤å®˜';
            if (type === 'è´¢') return isSameYinYang ? 'åè´¢' : 'æ­£è´¢';
            if (type === 'å®˜æ€') return isSameYinYang ? 'ä¸ƒæ€' : 'æ­£å®˜';
            if (type === 'å°') return isSameYinYang ? 'åå°' : 'æ­£å°';
            return '';
        }

        // 2. åäºŒé•¿ç”Ÿ (æ˜Ÿè¿/è‡ªå)
        function getLuck(dayStem, branch) {
            const states = ['é•¿ç”Ÿ', 'æ²æµ´', 'å† å¸¦', 'ä¸´å®˜', 'å¸æ—º', 'è¡°', 'ç—…', 'æ­»', 'å¢“', 'ç»', 'èƒ', 'å…»'];
            // é˜³å¹²é¡ºè¡Œèµ·ç‚¹
            const yangStart = {'ç”²': 11, 'ä¸™': 2, 'æˆŠ': 2, 'åºš': 5, 'å£¬': 8};
            // é˜´å¹²é€†è¡Œèµ·ç‚¹ (é•¿ç”Ÿä½)
            const yinStart = {'ä¹™': 6, 'ä¸': 9, 'å·±': 9, 'è¾›': 0, 'ç™¸': 3};
            
            const bIdx = ZHI.indexOf(branch);
            const sIdx = GAN.indexOf(dayStem);
            const isYang = sIdx % 2 === 0;

            let idx;
            if (isYang) {
                idx = (bIdx - yangStart[dayStem] + 12) % 12;
            } else {
                idx = (yinStart[dayStem] - bIdx + 12) % 12;
            }
            return states[idx];
        }

        // 3. ç©ºäº¡ (åŸºäºæ—¥æŸ±æ—¬é¦–)
        function getKongWang(dayStem, dayBranch) {
            const sIdx = GAN.indexOf(dayStem);
            const bIdx = ZHI.indexOf(dayBranch);
            // æ—¬é¦– = åœ°æ”¯ - å¤©å¹²
            let diff = bIdx - sIdx;
            if (diff < 0) diff += 12;
            // 0:å­ä¸‘ç©º, 10:æˆŒäº¥ç©º, 8:ç”³é…‰ç©º, 6:åˆæœªç©º, 4:è¾°å·³ç©º, 2:å¯…å¯ç©º
            const map = {
                0: ['æˆŒ', 'äº¥'], // ç”²å­æ—¬
                10: ['ç”³', 'é…‰'], // ç”²æˆŒæ—¬
                8: ['åˆ', 'æœª'], // ç”²ç”³æ—¬
                6: ['è¾°', 'å·³'], // ç”²åˆæ—¬
                4: ['å¯…', 'å¯'], // ç”²è¾°æ—¬
                2: ['å­', 'ä¸‘']  // ç”²å¯…æ—¬
            };
            return map[diff];
        }

        // 4. ç¥ç…è®¡ç®— (å…¨é¢ç‰ˆ - åŒ…å«20+ç§ç¥ç…)
        function getShenSha(pillarBranch, dayStem, dayBranch, yearBranch, yearStem) {
            let list = [];
            const b = pillarBranch;
            const dStem = dayStem;
            const dBranch = dayBranch;
            const yBranch = yearBranch;

            // --- è´µäººç³»åˆ— ---
            // å¤©ä¹™è´µäºº (æ—¥å¹²/å¹´å¹²)
            const noble = {'ç”²':['ä¸‘','æœª'], 'æˆŠ':['ä¸‘','æœª'], 'åºš':['ä¸‘','æœª'], 'ä¹™':['å­','ç”³'], 'å·±':['å­','ç”³'], 'ä¸™':['é…‰','äº¥'], 'ä¸':['é…‰','äº¥'], 'å£¬':['å·³','å¯'], 'ç™¸':['å·³','å¯'], 'è¾›':['å¯…','åˆ']};
            if(noble[dStem]?.includes(b) || noble[yearStem]?.includes(b)) list.push({name:'å¤©ä¹™è´µäºº', type:'good'});

            // å¤ªæè´µäºº (æ—¥å¹²)
            const taiji = {'ç”²':['å­','åˆ'], 'ä¹™':['å­','åˆ'], 'ä¸™':['å¯','é…‰'], 'ä¸':['å¯','é…‰'], 'æˆŠ':['è¾°','æˆŒ','ä¸‘','æœª'], 'å·±':['è¾°','æˆŒ','ä¸‘','æœª'], 'åºš':['å¯…','äº¥'], 'è¾›':['å¯…','äº¥'], 'å£¬':['å·³','ç”³'], 'ç™¸':['å·³','ç”³']};
            if(taiji[dStem]?.includes(b)) list.push({name:'å¤ªæè´µäºº', type:'good'});

            // æ–‡æ˜Œè´µäºº (æ—¥å¹²) - è¯»ä¹¦ã€æ‰å
            const wenchang = {'ç”²':'å·³', 'ä¹™':'åˆ', 'ä¸™':'ç”³', 'æˆŠ':'ç”³', 'ä¸':'é…‰', 'å·±':'é…‰', 'åºš':'äº¥', 'è¾›':'å­', 'å£¬':'å¯…', 'ç™¸':'å¯'};
            if(wenchang[dStem] === b) list.push({name:'æ–‡æ˜Œ', type:'good'});

            // ç¦„ç¥ (æ—¥å¹²) - è´¢ç¦„
            const lu = {'ç”²':'å¯…', 'ä¹™':'å¯', 'ä¸™':'å·³', 'ä¸':'åˆ', 'æˆŠ':'å·³', 'å·±':'åˆ', 'åºš':'ç”³', 'è¾›':'é…‰', 'å£¬':'äº¥', 'ç™¸':'å­'};
            if(lu[dStem] === b) list.push({name:'ç¦„ç¥', type:'good'});
            
            // é‡‘èˆ† (æ—¥å¹²) - è´¢å¯Œã€é…å¶ (ç¦„å‰äºŒä½)
            const jinyuIdx = (ZHI.indexOf(lu[dStem]) + 2) % 12;
            if (ZHI[jinyuIdx] === b) list.push({name:'é‡‘èˆ†', type:'good'});

            // --- å‡¶ç…ç³»åˆ— ---
            // ç¾Šåˆƒ (æ—¥å¹²ï¼Œé˜³å¹²æœ€é‡)
            const yangren = {'ç”²':'å¯', 'ä¹™':'è¾°', 'ä¸™':'åˆ', 'ä¸':'æœª', 'æˆŠ':'åˆ', 'å·±':'æœª', 'åºš':'é…‰', 'è¾›':'æˆŒ', 'å£¬':'å­', 'ç™¸':'ä¸‘'};
            if(yangren[dStem] === b) list.push({name:'ç¾Šåˆƒ', type:'bad'});

            // æ¡ƒèŠ± (å’¸æ± ) - å¹´/æ—¥æ”¯ ç”³å­è¾°åœ¨é…‰...
            const taohua = {'ç”³':'é…‰','å­':'é…‰','è¾°':'é…‰', 'å¯…':'å¯','åˆ':'å¯','æˆŒ':'å¯', 'å·³':'åˆ','é…‰':'åˆ','ä¸‘':'åˆ', 'äº¥':'å­','å¯':'å­','æœª':'å­'};
            if(taohua[dBranch] === b || taohua[yBranch] === b) list.push({name:'æ¡ƒèŠ±', type:'neutral'});

            // é©¿é©¬ (å˜åŠ¨) - å¹´/æ—¥æ”¯ ç”³å­è¾°åœ¨å¯…...
            const yima = {'ç”³':'å¯…','å­':'å¯…','è¾°':'å¯…', 'å¯…':'ç”³','åˆ':'ç”³','æˆŒ':'ç”³', 'å·³':'äº¥','é…‰':'äº¥','ä¸‘':'äº¥', 'äº¥':'å·³','å¯':'å·³','æœª':'å·³'};
            if(yima[dBranch] === b || yima[yBranch] === b) list.push({name:'é©¿é©¬', type:'neutral'});

            // åç›– (è‰ºæœ¯ã€å­¤ç‹¬) - å¹´/æ—¥æ”¯ ä¸‰åˆå±€å¢“åº“
            const huagai = {'ç”³':'è¾°','å­':'è¾°','è¾°':'è¾°', 'å¯…':'æˆŒ','åˆ':'æˆŒ','æˆŒ':'æˆŒ', 'å·³':'ä¸‘','é…‰':'ä¸‘','ä¸‘':'ä¸‘', 'äº¥':'æœª','å¯':'æœª','æœª':'æœª'};
            if(huagai[dBranch] === b || huagai[yBranch] === b) list.push({name:'åç›–', type:'neutral'});

            // å°†æ˜Ÿ (æƒåŠ›) - ä¸‰åˆå±€ä¸­ç¥
            const jiangxing = {'ç”³':'å­','å­':'å­','è¾°':'å­', 'å¯…':'åˆ','åˆ':'åˆ','æˆŒ':'åˆ', 'å·³':'é…‰','é…‰':'é…‰','ä¸‘':'é…‰', 'äº¥':'å¯','å¯':'å¯','æœª':'å¯'};
            if(jiangxing[dBranch] === b || jiangxing[yBranch] === b) list.push({name:'å°†æ˜Ÿ', type:'good'});

            // å­¤è¾°/å¯¡å®¿ (å¹´æ”¯) - æ–¹ä½
            // äº¥å­ä¸‘(åŒ—) -> å¯…(å­¤)/æˆŒ(å¯¡)
            const guchen = {'äº¥':'å¯…','å­':'å¯…','ä¸‘':'å¯…', 'å¯…':'å·³','å¯':'å·³','è¾°':'å·³', 'å·³':'ç”³','åˆ':'ç”³','æœª':'ç”³', 'ç”³':'äº¥','é…‰':'äº¥','æˆŒ':'äº¥'};
            const guasu =  {'äº¥':'æˆŒ','å­':'æˆŒ','ä¸‘':'æˆŒ', 'å¯…':'ä¸‘','å¯':'ä¸‘','è¾°':'ä¸‘', 'å·³':'è¾°','åˆ':'è¾°','æœª':'è¾°', 'ç”³':'æœª','é…‰':'æœª','æˆŒ':'æœª'};
            if(guchen[yBranch] === b) list.push({name:'å­¤è¾°', type:'bad'});
            if(guasu[yBranch] === b) list.push({name:'å¯¡å®¿', type:'bad'});
            
            // åŠ«ç… (ç”³å­è¾°åœ¨å·³...)
            const jiesha = {'ç”³':'å·³','å­':'å·³','è¾°':'å·³', 'å¯…':'äº¥','åˆ':'äº¥','æˆŒ':'äº¥', 'å·³':'ç”³','é…‰':'ç”³','ä¸‘':'ç”³', 'äº¥':'å¯…','å¯':'å¯…','æœª':'å¯…'};
            if(jiesha[yBranch] === b) list.push({name:'åŠ«ç…', type:'bad'});
            
            // äº¡ç¥ (ç”³å­è¾°åœ¨äº¥...)
            const wangshen = {'ç”³':'äº¥','å­':'äº¥','è¾°':'äº¥', 'å¯…':'å·³','åˆ':'å·³','æˆŒ':'å·³', 'å·³':'å¯…','é…‰':'å¯…','ä¸‘':'å¯…', 'äº¥':'ç”³','å¯':'ç”³','æœª':'ç”³'};
            if(wangshen[yBranch] === b) list.push({name:'äº¡ç¥', type:'bad'});

            // å…ƒè¾° (å¤§è€—) - é˜³ç”·é˜´å¥³ å†²å‰ä¸€ä½... (æ­¤å¤„ç®€åŒ–ä¸ºå…­å®³ä½)
            // ç•¥è¿‡å¤æ‚ç®—æ³•ï¼Œä»…ä½œç¤ºä¾‹

            return list;
        }

        // --- ä¸»é€»è¾‘ä¸äº¤äº’ ---
        let chartInstance = null;

        document.getElementById('bazi-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value || "ç¼˜ä¸»";
            const gender = document.getElementById('gender').value; // 1=ç”·, 0=å¥³
            const dateStr = document.getElementById('birthDate').value;
            const timeStr = document.getElementById('birthTime').value;
            
            if(!dateStr || !timeStr) { alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯"); return; }
            
            const date = new Date(dateStr);
            const [h, m] = timeStr.split(':').map(Number);

            // --- 1. æ’ç›˜è®¡ç®— (ç²¾ç®€ç‰ˆå†æ³•) ---
            // å¹´
            let year = date.getFullYear();
            const mon = date.getMonth() + 1; // 1-12
            const day = date.getDate();
            // ç«‹æ˜¥åˆ†ç•Œ (ç®€åŒ–: 2æœˆ4æ—¥)
            let baziYear = year;
            if(mon < 2 || (mon === 2 && day < 4)) baziYear = year - 1;
            
            const yStemIdx = (baziYear - 4) % 10;
            const yBranchIdx = (baziYear - 4) % 12;
            const yStem = GAN[yStemIdx < 0 ? yStemIdx+10 : yStemIdx];
            const yBranch = ZHI[yBranchIdx < 0 ? yBranchIdx+12 : yBranchIdx];

            // æœˆ (äº”è™é)
            // ç²—ç•¥èŠ‚æ°”: 2.4ç«‹æ˜¥(å¯…), 3.6æƒŠè›°(å¯)...
            // ç®€å•æ˜ å°„
            let mBranchIdx = 2; // é»˜è®¤å¯…
            const val = mon * 100 + day;
            if(val>=204 && val<306) mBranchIdx=2; // å¯…
            else if(val>=306 && val<405) mBranchIdx=3; // å¯
            else if(val>=405 && val<506) mBranchIdx=4; // è¾°
            else if(val>=506 && val<606) mBranchIdx=5; // å·³
            else if(val>=606 && val<707) mBranchIdx=6; // åˆ
            else if(val>=707 && val<808) mBranchIdx=7; // æœª
            else if(val>=808 && val<908) mBranchIdx=8; // ç”³
            else if(val>=908 && val<1008) mBranchIdx=9; // é…‰
            else if(val>=1008 && val<1108) mBranchIdx=10; // æˆŒ
            else if(val>=1108 && val<1207) mBranchIdx=11; // äº¥
            else if(val>=1207 || val<106) mBranchIdx=0; // å­
            else mBranchIdx=1; // ä¸‘ (1.6 - 2.3)

            const yStemIndexForMonth = GAN.indexOf(yStem);
            // ç”²å·±ä¹‹å¹´ä¸™ä½œé¦– (0,5 -> 2)
            const mStart = (yStemIndexForMonth % 5) * 2 + 2;
            // å¯…æœˆæ˜¯ç¬¬0ä¸ªæœˆ (ç›¸å¯¹äºç«‹æ˜¥)
            let monthOffset = mBranchIdx - 2; 
            if(monthOffset < 0) monthOffset += 12;
            const mStem = GAN[(mStart + monthOffset) % 10];
            const mBranch = ZHI[mBranchIdx];

            // æ—¥ (UTC 1900-1-1 åŸºå‡†)
            const base = new Date(1900, 0, 1);
            let diff = Math.floor((date - base) / 86400000);
            // 23ç‚¹åç®—æ¬¡æ—¥
            if(h >= 23) diff++;
            // 1900-1-1 æ˜¯ç”²æˆŒ(10)
            let dIdx = (10 + diff) % 60;
            if(dIdx < 0) dIdx += 60;
            const dStem = GAN[dIdx % 10];
            const dBranch = ZHI[dIdx % 12];

            // æ—¶ (äº”é¼ é)
            let hBranchIdx = 0;
            if (h >= 23 || h < 1) hBranchIdx = 0;
            else hBranchIdx = Math.floor((h + 1) / 2);
            
            const dStemIndex = GAN.indexOf(dStem);
            // ç”²å·±è¿˜åŠ ç”² (0,5 -> 0)
            const hStart = (dStemIndex % 5) * 2;
            const hStem = GAN[(hStart + hBranchIdx) % 10];
            const hBranch = ZHI[hBranchIdx];

            const pillars = {
                year: { s: yStem, b: yBranch },
                month: { s: mStem, b: mBranch },
                day: { s: dStem, b: dBranch },
                hour: { s: hStem, b: hBranch }
            };

            // --- 2. æ¸²æŸ“åŸºç¡€è¡¨æ ¼ ---
            document.getElementById('res-name').innerText = name;
            document.getElementById('res-gender').innerText = gender === '1' ? 'ä¹¾é€ ' : 'å¤é€ ';
            document.getElementById('res-solar-date').innerText = dateStr + ` ${h}æ—¶`;

            // ç©ºäº¡
            const kongwang = getKongWang(dStem, dBranch);

            // å¾ªç¯æ¸²æŸ“å››æŸ±
            ['year', 'month', 'day', 'hour'].forEach(p => {
                const s = pillars[p].s;
                const b = pillars[p].b;
                
                // å¤©å¹²åœ°æ”¯
                document.getElementById(`stem-${p}`).innerText = s;
                document.getElementById(`branch-${p}`).innerText = b;
                document.getElementById(`stem-${p}`).style.color = WUXING_COLORS[WUXING_MAP[s]];
                document.getElementById(`branch-${p}`).style.color = WUXING_COLORS[WUXING_MAP[b]];

                // åç¥
                if(p !== 'day') document.getElementById(`god-${p}`).innerText = getTenGod(dStem, s);

                // è—å¹² & å‰¯æ˜Ÿ
                const hiddens = CANG_GAN[b];
                const subGods = hiddens.map(h => getTenGod(dStem, h));
                document.getElementById(`subgod-${p}`).innerHTML = subGods.join('<br>');

                // æ˜Ÿè¿
                document.getElementById(`luck-${p}`).innerText = getLuck(dStem, b);

                // è‡ªå (å¤©å¹²å¯¹åœ°æ”¯)
                document.getElementById(`zizuo-${p}`).innerText = getLuck(s, b);

                // çº³éŸ³
                document.getElementById(`nayin-${p}`).innerText = NAYIN[s+b] || '-';

                // ç©ºäº¡
                if (kongwang.includes(b)) {
                    const kwEl = document.getElementById(`kongwang-${p}`);
                    kwEl.innerHTML = '<span class="text-red-500 font-bold border border-red-500 rounded px-1 text-xs">ç©ºäº¡</span>';
                } else {
                    document.getElementById(`kongwang-${p}`).innerText = '-';
                }

                // ç¥ç…
                const stars = getShenSha(b, dStem, dBranch, yBranch, yStem);
                const starHtml = stars.map(star => {
                    const colorClass = star.type === 'good' ? 'tag-good' : (star.type === 'bad' ? 'tag-bad' : 'tag-neutral');
                    return `<span class="tag-pill ${colorClass}">${star.name}</span>`;
                }).join('');
                document.getElementById(`shensha-${p}`).innerHTML = starHtml || '-';
            });

            // --- 3. äº”è¡Œç»Ÿè®¡ä¸é€šä¿—å»ºè®® ---
            let scores = {wood:0, fire:0, earth:0, metal:0, water:0};
            
            function addScore(elem, val) { scores[WUXING_MAP[elem]] += val; }
            
            ['year', 'month', 'day', 'hour'].forEach(p => {
                addScore(pillars[p].s, 10); // å¤©å¹²
                const hiddens = CANG_GAN[pillars[p].b];
                addScore(hiddens[0], 10); // æœ¬æ°”
                if(p === 'month') addScore(hiddens[0], 15); // æœˆä»¤åŠ æƒ
                if(hiddens[1]) addScore(hiddens[1], 5);
                if(hiddens[2]) addScore(hiddens[2], 3);
            });

            // æ¸²æŸ“å›¾è¡¨
            const ctx = document.getElementById('wuxingChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['æœ¨ (å¥åº·/ä»)', 'ç« (çƒ­æƒ…/ç¤¼)', 'åœŸ (è¯šä¿¡/ä¿¡)', 'é‡‘ (æ‰§è¡Œ/ä¹‰)', 'æ°´ (æ™ºæ…§/æ™º)'],
                    datasets: [{
                        label: 'äº”è¡Œèƒ½é‡æŒ‡æ•°',
                        data: [scores.wood, scores.fire, scores.earth, scores.metal, scores.water],
                        backgroundColor: [WUXING_COLORS.wood, WUXING_COLORS.fire, WUXING_COLORS.earth, WUXING_COLORS.metal, WUXING_COLORS.water],
                        borderRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // å¡«å……å¾—åˆ†æ–‡æœ¬
            document.getElementById('score-wood').innerText = scores.wood;
            document.getElementById('score-fire').innerText = scores.fire;
            document.getElementById('score-earth').innerText = scores.earth;
            document.getElementById('score-metal').innerText = scores.metal;
            document.getElementById('score-water').innerText = scores.water;

            // --- é€šä¿—åŒ–å»ºè®®é€»è¾‘ ---
            const dElem = WUXING_MAP[dStem];
            const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
            const strongest = sorted[0]; // [elem, score]
            const weakest = sorted[4];
            
            // ç®€å•èº«å¼ºèº«å¼±åˆ¤æ–­ (ä»…ä¾›å‚è€ƒ)
            const selfScore = scores[dElem] + scores[dElem==='wood'?'water':(dElem==='fire'?'wood':(dElem==='earth'?'fire':(dElem==='metal'?'earth':'metal')))];
            const totalScore = Object.values(scores).reduce((a,b)=>a+b,0);
            const isStrong = selfScore > (totalScore * 0.45);

            // ç”Ÿæˆå»ºè®® HTML
            let adviceHtml = '';
            
            // 1. ç¼ºä»€ä¹ˆ/å¤ªæ—ºä»€ä¹ˆ
            adviceHtml += `<p><strong>ğŸ“Š èƒ½é‡çŠ¶æ€ï¼š</strong>æ‚¨çš„äº”è¡Œèƒ½é‡ä¸­ï¼Œ<span class="text-red-700 font-bold">${WUXING_CN[strongest[0]]}</span>æ°”åœºæœ€å¼ºï¼Œ<span class="text-blue-700 font-bold">${WUXING_CN[weakest[0]]}</span>æ°”åœºæœ€å¼±ã€‚</p>`;
            
            // 2. è¡¥è¿å»ºè®® (ç”¨äººè¯)
            const lackElem = weakest[0];
            const suggestions = {
                'wood': {
                    color: 'ç»¿è‰²ã€é’è‰²', item: 'æœ¨åˆ¶é¥°å“ã€æ¤ç‰©', action: 'å¤šè¯»ä¹¦ã€å…»èŠ±è‰ã€åšæŒæ—©èµ·ã€å¤šåƒè”¬èœ', dir: 'ä¸œæ–¹',
                    desc: 'æ‚¨éœ€è¦è¡¥å……â€œæœ¨â€æ°”ã€‚åœ¨æ€§æ ¼ä¸Šï¼Œè¦å­¦ä¹ æ ‘æœ¨çš„â€œå‘ä¸Šâ€å’Œâ€œä»æ…ˆâ€ï¼Œåšäº‹ä¸è¦å¤ªå†²åŠ¨æˆ–å¤ªæ‚²è§‚ï¼Œå¤šä¸€ç‚¹è€å¿ƒå’ŒåŒ…å®¹ã€‚'
                },
                'fire': {
                    color: 'çº¢è‰²ã€ç´«è‰²ã€ç²‰è‰²', item: 'ç”µå­äº§å“ã€å…‰äº®ç‰©', action: 'å¤šæ™’å¤ªé˜³ã€å¤šç¬‘ã€å¤šç¤¾äº¤ã€æ¼”è®²', dir: 'å—æ–¹',
                    desc: 'æ‚¨éœ€è¦è¡¥å……â€œç«â€æ°”ã€‚åœ¨æ€§æ ¼ä¸Šï¼Œè¦è®©è‡ªå·±æ›´çƒ­æƒ…ã€å¼€æœ—ä¸€ç‚¹ï¼Œä¸è¦å¤ªé«˜å†·æˆ–æ¶ˆæã€‚å¤šå±•ç¤ºè‡ªå·±ï¼Œåƒå¤ªé˜³ä¸€æ ·æ¸©æš–åˆ«äººã€‚'
                },
                'earth': {
                    color: 'é»„è‰²ã€æ£•è‰²ã€å¡å…¶è‰²', item: 'ç‰çŸ³ã€é™¶å™¨', action: 'çˆ¬å±±ã€èµ¤è„šè¸©åœŸã€åŠ¡å®åšäº‹', dir: 'æœ¬åœ°æˆ–ä¸­å¤®',
                    desc: 'æ‚¨éœ€è¦è¡¥å……â€œåœŸâ€æ°”ã€‚åœ¨æ€§æ ¼ä¸Šï¼Œè¦å­¦ä¹ å¤§åœ°çš„â€œåšé‡â€å’Œâ€œè¯šä¿¡â€ã€‚åšäº‹è¦è„šè¸å®åœ°ï¼Œä¸è¦èƒ¡æ€ä¹±æƒ³ï¼Œæ‰¿è¯ºçš„äº‹æƒ…è¦åšåˆ°ã€‚'
                },
                'metal': {
                    color: 'ç™½è‰²ã€é‡‘è‰²ã€é“¶ç°è‰²', item: 'é‡‘å±é¥°å“ã€é‡‘è¡¨', action: 'å¥èº«ã€æ•´ç†æ”¶çº³ã€åˆ¶å®šè®¡åˆ’', dir: 'è¥¿æ–¹',
                    desc: 'æ‚¨éœ€è¦è¡¥å……â€œé‡‘â€æ°”ã€‚åœ¨æ€§æ ¼ä¸Šï¼Œè¦å­¦ä¹ é‡‘å±çš„â€œæœæ–­â€å’Œâ€œä¹‰æ°”â€ã€‚åšäº‹è¦æœ‰æ¡ç†ï¼Œè¯¥æ–­åˆ™æ–­ï¼Œä¸è¦æ‹–æ³¥å¸¦æ°´ã€‚'
                },
                'water': {
                    color: 'é»‘è‰²ã€è“è‰²', item: 'æ°´æ™¶ã€é±¼ç¼¸', action: 'æ¸¸æ³³ã€å–æ°´ã€æ€è€ƒã€æ—…æ¸¸', dir: 'åŒ—æ–¹',
                    desc: 'æ‚¨éœ€è¦è¡¥å……â€œæ°´â€æ°”ã€‚åœ¨æ€§æ ¼ä¸Šï¼Œè¦å­¦ä¹ æ°´çš„â€œçµåŠ¨â€å’Œâ€œæ™ºæ…§â€ã€‚é‡åˆ°å›°éš¾å­¦ä¼šè½¬å¼¯ï¼Œå¤šåŠ¨è„‘å­ï¼Œä¸è¦å¤ªå›ºæ‰§æ­»æ¿ã€‚'
                }
            };
            
            const sug = suggestions[lackElem];
            adviceHtml += `<p><strong>ğŸ€ è¡¥è¿æŒ‡å—ï¼š</strong>${sug.desc}</p>`;
            adviceHtml += `<ul class="list-disc pl-5 mt-2 space-y-1">
                <li><strong>å¹¸è¿è‰²ï¼š</strong>å¤šç©¿${sug.color}çš„è¡£æœã€‚</li>
                <li><strong>å¼€è¿ç‰©ï¼š</strong>ä½©æˆ´${sug.item}ã€‚</li>
                <li><strong>æ—¥å¸¸è¡ŒåŠ¨ï¼š</strong>å»ºè®®${sug.action}ã€‚</li>
                <li><strong>æœ‰åˆ©æ–¹ä½ï¼š</strong>å¤šå¾€${sug.dir}èµ°åŠ¨æˆ–å‘å±•ã€‚</li>
            </ul>`;

            document.getElementById('vernacular-advice').innerHTML = adviceHtml;

            // --- é˜´é˜³ä¸æ ¼å±€å¤§ç™½è¯ ---
            const yinyang = (GAN.indexOf(dStem)%2 === 0) ? 'é˜³' : 'é˜´';
            const yyDesc = yinyang === 'é˜³' 
                ? 'æ‚¨çš„æ€§æ ¼åº•è‰²åå‘â€œç§¯æã€ä¸»åŠ¨ã€å¤–å‘â€ã€‚é‡åˆ°äº‹æƒ…å–œæ¬¢ç›´æ¥è§£å†³ï¼Œä½†ä¹Ÿå®¹æ˜“æ€¥èºã€‚å»ºè®®æœ‰æ—¶å€™å­¦ä¼šâ€œæ…¢ä¸‹æ¥â€ï¼Œå¤šå¬å¬åˆ«äººçš„æ„è§ã€‚'
                : 'æ‚¨çš„æ€§æ ¼åº•è‰²åå‘â€œå†…æ•›ã€ç»†è…»ã€ç¨³é‡â€ã€‚å–„äºæ€è€ƒå’Œå¿è€ï¼Œä½†æœ‰æ—¶å€™å®¹æ˜“æŠŠè¯æ†‹åœ¨å¿ƒé‡Œã€‚å»ºè®®å¤šè¡¨è¾¾è‡ªå·±çš„çœŸå®æƒ³æ³•ã€‚';
            document.getElementById('yinyang-text').innerText = yyDesc;

            const strDesc = isStrong 
                ? 'æ‚¨çš„å‘½å±€èƒ½é‡â€œåå¼ºâ€ã€‚è¿™å°±åƒä¸€è¾†è½¦é©¬åŠ›å¾ˆå¤§ï¼Œä¼˜ç‚¹æ˜¯æŠ—å‹èƒ½åŠ›å¼ºï¼Œèƒ½æ‰¿æ‹…é‡ä»»ï¼›ç¼ºç‚¹æ˜¯å®¹æ˜“è‡ªæˆ‘ä¸­å¿ƒï¼Œå›ºæ‰§ã€‚å»ºè®®æ‚¨å¤šâ€œè¾“å‡ºâ€ï¼Œæ¯”å¦‚å»å¸®åŠ©åˆ«äººã€å»åˆ›ä½œã€å»æ‹¼äº‹ä¸šï¼ŒæŠŠè¿‡å‰©çš„ç²¾åŠ›é‡Šæ”¾å‡ºæ¥ï¼Œä¸è¦æ†‹ç€ã€‚' 
                : 'æ‚¨çš„å‘½å±€èƒ½é‡â€œåå¼±â€ã€‚è¿™å°±åƒä¸€è¾†è½¦æ²¹è€—ä½ä½†è½½é‡æœ‰é™ï¼Œä¼˜ç‚¹æ˜¯å¿ƒæ€ç»†è…»ï¼Œæ•æ„Ÿï¼›ç¼ºç‚¹æ˜¯å®¹æ˜“ç´¯ï¼Œå®¹æ˜“å—ç¯å¢ƒå½±å“ã€‚å»ºè®®æ‚¨å¤šâ€œå……ç”µâ€ï¼Œå¤šä¾é å›¢é˜Ÿã€é•¿è¾ˆã€æœ‹å‹çš„æ”¯æŒï¼Œä¸è¦æ€»æ˜¯å•æ‰“ç‹¬æ–—ã€‚';
            document.getElementById('strength-text').innerText = strDesc;

            // æ ¼å±€ç®€å•åˆ¤æ–­
            const mMainGas = CANG_GAN[mBranch][0];
            const patternGod = getTenGod(dStem, mMainGas);
            let pName = patternGod + "æ ¼";
            if(patternGod === 'æ¯”è‚©') pName = "å»ºç¦„æ ¼ (é è‡ªå·±)";
            if(patternGod === 'åŠ«è´¢') pName = "æœˆåˆƒæ ¼ (æ‹¼æå‹)";
            document.getElementById('pattern-name').innerText = pName;
            document.getElementById('pattern-desc').innerText = `æ ¼å±€å†³å®šäº†æ‚¨çš„ç¤¾ä¼šè§’è‰²ã€‚${patternGod}ä¸ºä¸»å¯¼ï¼Œæ„å‘³ç€æ‚¨åœ¨ç¤¾ä¼šä¸­æ›´å®¹æ˜“é€šè¿‡â€œ${patternGod}â€ç›¸å…³çš„ç‰¹è´¨ï¼ˆå¦‚${patternGod.includes('è´¢')?'å•†ä¸š/é‡‘é’±':(patternGod.includes('å®˜')?'ç®¡ç†/åå£°':'æ‰å/æŠ€æœ¯')}ï¼‰è·å¾—æˆåŠŸã€‚`;

            // --- 4. ä¸€ç”Ÿè¯¦æ‰¹ (åŠ¨æ€å‚æ•°æ³¨å…¥) ---
            
            // æ ¹ (Year)
            const yGod = getTenGod(dStem, yStem);
            const yLuck = getLuck(dStem, yBranch);
            const yStars = getShenSha(yBranch, dStem, dBranch, yBranch, yStem).map(s=>s.name);
            document.getElementById('ref-year').innerText = `[${yStem}${yBranch}] ä¸»æ˜Ÿ:${yGod} æ˜Ÿè¿:${yLuck} ç¥ç…:${yStars.join(' ')||'æ— '}`;
            document.getElementById('detail-year').innerHTML = `
                æ­¤é˜¶æ®µä»£è¡¨æ‚¨çš„<strong>ç¥–ä¸šå’Œç«¥å¹´</strong>ã€‚
                <br>1. <strong>ç¥–è¾ˆå…³ç³»ï¼š</strong>å¹´å¹²é€å‡ºâ€œ${yGod}â€ï¼Œ${yGod.includes('è´¢')?'ç¥–çˆ¶è¾ˆå¤šæœ‰ç»å•†æˆ–ç»æµå¤´è„‘':(yGod.includes('å°')?'ç¥–ä¸Šå¤šä¸ºä¹¦é¦™æˆ–ç§¯å–„ä¹‹å®¶':'ç¥–è¾ˆæ€§æ ¼è¾ƒä¸ºåˆšçƒˆæˆ–å¥”æ³¢')}ã€‚
                <br>2. <strong>ç«¥å¹´é™…é‡ï¼š</strong>å¹´æ”¯åâ€œ${yLuck}â€ï¼Œ${['é•¿ç”Ÿ','å¸æ—º','å† å¸¦'].includes(yLuck)?'è¯´æ˜æ‚¨å‡ºç”Ÿæ—¶å®¶è¿å¤„äºä¸Šå‡æœŸï¼Œç«¥å¹´ç”Ÿæ´»ç›¸å¯¹é¡ºé‚ï¼Œä½“è´¨è¾ƒå¥½ã€‚': 'è¯´æ˜æ‚¨å‡ºç”Ÿæ—¶å®¶å¢ƒå¯èƒ½æ¯”è¾ƒå¹³æ·¡ï¼Œæˆ–è€…å°æ—¶å€™èº«ä½“è¾ƒå¼±ï¼Œéœ€è¦å¤šåŠ å…»æŠ¤ã€‚'}
                <br>3. <strong>ç¥ç…å½±å“ï¼š</strong>${yStars.includes('é©¿é©¬')?'å¹´æŸ±å¸¦é©¿é©¬ï¼Œè¯´æ˜æ‚¨å¾ˆå°çš„æ—¶å€™å¯èƒ½å°±éšçˆ¶æ¯å¥”æ³¢æ¬å®¶ï¼Œæˆ–è€…å®¹æ˜“ç¦»å®¶æ±‚å­¦ã€‚':(yStars.includes('å¤©ä¹™è´µäºº')?'å¹´å¸¦è´µäººï¼Œå°æ—¶å€™å®¹æ˜“é‡åˆ°å¥½è€å¸ˆæˆ–é•¿è¾ˆå…³ç…§ï¼Œé€¢å‡¶åŒ–å‰ã€‚':'ç«¥å¹´ç›¸å¯¹å¹³ç¨³ã€‚')}
            `;

            // è‹— (Month)
            const mGod = getTenGod(dStem, mStem);
            const mStars = getShenSha(mBranch, dStem, dBranch, yBranch, yStem).map(s=>s.name);
            document.getElementById('ref-month').innerText = `[${mStem}${mBranch}] ä¸»æ˜Ÿ:${mGod} çº³éŸ³:${NAYIN[mStem+mBranch]}`;
            document.getElementById('detail-month').innerHTML = `
                æ­¤é˜¶æ®µä»£è¡¨æ‚¨çš„<strong>é’å¹´æ—¶æœŸã€æ€§æ ¼å…»æˆåŠçˆ¶æ¯å…„å¼Ÿ</strong>ã€‚
                <br>1. <strong>æ€§æ ¼æ ¸å¿ƒï¼š</strong>æœˆä»¤æ˜¯å…«å­—çš„å¸ä»¤éƒ¨ã€‚æ‚¨ç”Ÿäº${WUXING_CN[WUXING_MAP[mBranch]]}æ—ºçš„æœˆä»½ï¼Œ${WUXING_MAP[mBranch] === 'fire' ? 'æ€§æ ¼çƒ­æƒ…æ€¥èºï¼Œå¦‚ç«' : (WUXING_MAP[mBranch] === 'water' ? 'æ€ç»´çµæ´»å¤šå˜ï¼Œå¦‚æ°´' : 'æ€§æ ¼è¾ƒä¸ºç¨³é‡')}ã€‚
                <br>2. <strong>é’å¹´è¿åŠ¿ï¼š</strong>æœˆå¹²â€œ${mGod}â€ä¸»å¯¼äº†æ‚¨è¸å…¥ç¤¾ä¼šåˆæœŸçš„é™…é‡ã€‚${mGod.includes('æ€')||mGod.includes('ä¼¤') ? 'é’å¹´æ—¶æœŸå®¹æ˜“å›é€†ï¼Œä¸æœç®¡æ•™ï¼Œå–œæ¬¢æŒ‘æˆ˜æƒå¨ï¼Œé€‚åˆå»å¤–åœ°é—¯è¡ã€‚' : 'é’å¹´æ—¶æœŸæ¯”è¾ƒå¾ªè§„è¹ˆçŸ©ï¼ŒæŒ‰éƒ¨å°±ç­åœ°ä¸Šå­¦ã€å·¥ä½œã€‚'}
                <br>3. <strong>å®¶åº­å…³ç³»ï¼š</strong>æœˆæ”¯ä¸ºçˆ¶æ¯å®«ã€‚${kongwang.includes(mBranch)?'æœˆæ”¯é€¢ç©ºäº¡ï¼Œå¯èƒ½ä¸çˆ¶æ¯ç¼˜åˆ†ç¨æµ…ï¼Œæˆ–è€…é’å¹´æ—¶æœŸæ„Ÿè§‰å†…å¿ƒæ¯”è¾ƒç©ºè™šè¿·èŒ«ï¼Œæ‰¾ä¸åˆ°æ–¹å‘ã€‚':'ä¸å®¶åº­è”ç³»ç´§å¯†ã€‚'}
            `;

            // èŠ± (Day)
            const dLuck = getLuck(dStem, dBranch);
            const dStars = getShenSha(dBranch, dStem, dBranch, yBranch, yStem).map(s=>s.name);
            document.getElementById('ref-day').innerText = `[${dStem}${dBranch}] è‡ªå:${dLuck} ç¥ç…:${dStars.join(' ')}`;
            document.getElementById('detail-day').innerHTML = `
                æ­¤é˜¶æ®µä»£è¡¨æ‚¨çš„<strong>ä¸­å¹´é»„é‡‘æœŸã€è‡ªæˆ‘åŠå©šå§»</strong>ã€‚
                <br>1. <strong>è‡ªæˆ‘çŠ¶æ€ï¼š</strong>æ—¥å¹²ä»£è¡¨æ‚¨è‡ªå·±ã€‚è‡ªåâ€œ${dLuck}â€åœ°ï¼Œ${['å¸æ—º','ä¸´å®˜'].includes(dLuck)?'è¯´æ˜æ‚¨ä¸­å¹´æ—¶æœŸä¸ªäººèƒ½åŠ›æå¼ºï¼Œè‡ªä¿¡å¿ƒçˆ†æ£šï¼Œæ˜¯äº‹ä¸šçš„å·…å³°æœŸã€‚':'è¯´æ˜æ‚¨ä¸­å¹´æ—¶æœŸæ›´å€¾å‘äºç¨³å®ˆï¼Œåšäº‹å°å¿ƒè°¨æ…ï¼Œä¸çˆ±å†’é™©ã€‚'}
                <br>2. <strong>å¤«å¦»å®«åˆ†æï¼š</strong>æ—¥æ”¯ä¸ºé…å¶å®«ã€‚${dBranch === mBranch ? 'æ—¥æœˆåœ°æ”¯ç›¸åŒï¼Œå©šå§»ä¸­å¯èƒ½ä¼šæœ‰äº‰åµï¼Œæˆ–è€…å¦ä¸€åŠæ€§æ ¼è·Ÿæ‚¨å¾ˆåƒï¼Œäº’ä¸ç›¸è®©ã€‚' : (dBranch === yBranch ? 'æ—¥å¹´ç›¸åŒï¼Œå¯èƒ½é…å¶ä¸æ‚¨é•¿è¾ˆå…³ç³»å¯†åˆ‡ï¼Œæˆ–æœ‰äº²ä¸ŠåŠ äº²ä¹‹è±¡ã€‚' : 'å¤«å¦»å®«ç›¸å¯¹ç¨³å®šã€‚')}
                <br>3. <strong>ç‰¹æ®Šç¥ç…ï¼š</strong>${dStars.includes('æ¡ƒèŠ±')?'æ—¥åæ¡ƒèŠ±ï¼Œè¯´æ˜æ‚¨ï¼ˆæˆ–é…å¶ï¼‰äººç¼˜æå¥½ï¼Œå¼‚æ€§ç¼˜æ—ºï¼Œä»äº‹äººé™…äº¤å¾€å·¥ä½œéå¸¸æœ‰åˆ©ï¼Œä½†ä¹Ÿè¦æ³¨æ„çƒ‚æ¡ƒèŠ±ã€‚':(dStars.includes('å­¤è¾°')||dStars.includes('å¯¡å®¿')||dStars.includes('åç›–')?'æ—¥å¸¦å­¤ç‹¬ä¹‹æ˜Ÿï¼Œä¸­å¹´æ—¶æœŸå†…å¿ƒå¯èƒ½æ¯”è¾ƒå­¤ç‹¬ï¼Œå–œæ¬¢ç‹¬å¤„ï¼Œæˆ–æ²‰è¿·äºå®—æ•™å“²å­¦ï¼Œä¸ä¼´ä¾£æ²Ÿé€šè¾ƒå°‘ã€‚':'')}
            `;

            // å©šå§»ä¸äº‹ä¸šå»ºè®®
            document.getElementById('marriage-advice').innerText = `é…å¶æ–¹å‘å»ºè®®æ‰¾å…«å­—ä¸­â€œ${lackElem}â€æ°”åœºå¼ºçš„äººäº’è¡¥ã€‚æ—¥æ”¯ä¸º${dBranch}ï¼Œ${['å­','åˆ','å¯','é…‰'].includes(dBranch)?'å¦ä¸€åŠå¤§æ¦‚ç‡é•¿ç›¸ä¸é”™ï¼Œæˆ–è€…æœ‰æ°”è´¨ï¼Œä½†è„¾æ°”ä¹Ÿå¤§ã€‚': 'å¦ä¸€åŠé•¿ç›¸æœ´å®ï¼Œæ€§æ ¼æ•¦åšï¼Œé¡¾å®¶ã€‚'}`;
            document.getElementById('career-advice').innerText = `äº‹ä¸šæ–¹å‘å»ºè®®å¾€${sug.dir}å‘å±•ã€‚è¡Œä¸šé€‰æ‹©ä¸Šï¼Œ${sug.desc.split('ã€‚')[0].replace('æ‚¨éœ€è¦è¡¥å……','ä»äº‹ä¸')}ç›¸å…³çš„è¡Œä¸šæœ€å®¹æ˜“è·å¾—æˆå°±ã€‚`;


            // æœ (Hour)
            const hGod = getTenGod(dStem, hStem);
            const hLuck = getLuck(dStem, hBranch);
            document.getElementById('ref-hour').innerText = `[${hStem}${hBranch}] ä¸»æ˜Ÿ:${hGod} æ˜Ÿè¿:${hLuck}`;
            document.getElementById('detail-hour').innerHTML = `
                æ­¤é˜¶æ®µä»£è¡¨æ‚¨çš„<strong>æ™šå¹´è¿åŠ¿åŠå­å¥³</strong>ã€‚
                <br>1. <strong>æ™šæ™¯æ¨æ–­ï¼š</strong>æ—¶æŸ±æ˜¯äººç”Ÿçš„å½’å®¿ã€‚æ—¶æ”¯åâ€œ${hLuck}â€ï¼Œ${['æ­»','å¢“','ç»'].includes(hLuck)?'æ™šå¹´å¿ƒæ€è¶‹äºå¹³æ·¡ï¼Œå¯èƒ½æ›´å–œæ¬¢æ¸…é™ï¼Œæˆ–è€…èº«ä½“èƒ½é‡ä¸‹é™ï¼Œé€‚åˆå…»ç”Ÿã€‚':'æ™šå¹´ä¾ç„¶ç²¾åŠ›æ—ºç››ï¼Œå¯èƒ½é€€è€Œä¸ä¼‘ï¼Œä¾ç„¶åœ¨ä¸ºå­å­™æˆ–äº‹ä¸šæ“åŠ³ã€‚'}
                <br>2. <strong>å­å¥³å…³ç³»ï¼š</strong>æ—¶å¹²é€å‡ºâ€œ${hGod}â€ã€‚${hGod.includes('é£Ÿ')||hGod.includes('ä¼¤')?'å­å¥³èªæ˜æœ‰æ‰åï¼Œæ™šå¹´èƒ½äº«å­å¥³çš„ç¦ï¼Œæˆ–è€…æ‚¨æ™šå¹´ä¾ç„¶æœ‰åƒå¹´è½»äººä¸€æ ·çš„å¿ƒæ€ã€‚':(hGod.includes('æ€')?'å­å¥³ä¸ªæ€§å¼ºï¼Œä¸åœ¨èº«è¾¹ï¼Œæˆ–è€…æ™šå¹´æ‚¨ä¾ç„¶æœ‰å¨ä¸¥ã€‚':'æ™šå¹´ç”Ÿæ´»å¹³ç¨³ã€‚')}
                <br>3. <strong>æœ€ç»ˆå»ºè®®ï¼š</strong>æ™šå¹´æœ€é‡è¦çš„ä¸æ˜¯é’±è´¢ï¼Œè€Œæ˜¯å¿ƒæ€ã€‚å»ºè®®å¤šæ¥è§¦äº”è¡Œå±â€œ${lackElem}â€çš„äº‹ç‰©æ¥å¹³è¡¡èº«å¿ƒã€‚
            `;

            // èƒå…ƒ/å‘½å®«/æ—¬é¦– (å·²ç§»é™¤ï¼Œç›´æ¥æ˜¾ç¤ºç©ºå€¼ä»¥ä¿æŒå¸ƒå±€)
            document.getElementById('taiyuan-text').parentElement.classList.add('hidden');
            document.getElementById('minggong-text').parentElement.classList.add('hidden');
            document.getElementById('xunshou-text').parentElement.classList.add('hidden');

            // Reveal
            document.getElementById('input-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
         // ã€Œè¿”å›é‡ç®—ã€æŒ‰é’®ï¼šéšè—ç»“æœï¼Œé‡æ–°æ˜¾ç¤ºè¾“å…¥åŒºå¹¶æ¸…ç©ºè¡¨å•
document.getElementById('btn-recalc').addEventListener('click', function () {
    // æ¸…ç©ºè¡¨å•
    document.getElementById('bazi-form').reset();

    // éšè—ç»“æœåŒºåŸŸ
    document.getElementById('result-area').classList.add('hidden');

    // æ˜¾ç¤ºè¾“å…¥åŒºåŸŸ
    document.getElementById('input-area').classList.remove('hidden');

    // é”€æ¯å›¾è¡¨ï¼Œé¿å…é‡å¤å åŠ 
    if (window.chartInstance) {
        window.chartInstance.destroy();
        window.chartInstance = null;
    }

    // å›åˆ°é¡¶éƒ¨
    window.scrollTo({ top: 0, behavior: 'smooth' });
});
    </script>
</body>
</html>




